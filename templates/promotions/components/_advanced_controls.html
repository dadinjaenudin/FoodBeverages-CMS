{% load humanize %}

<!-- Advanced Controls (Priority & Usage Limits) -->
<div class="bg-white border border-gray-200 rounded-lg px-3 py-2">
    <h3 class="text-xs font-semibold text-gray-900 mb-1.5 flex items-center">
        <i class="fas fa-shield-alt text-blue-600 mr-1.5 text-xs"></i>Advanced
    </h3>
    
    <div class="grid grid-cols-4 gap-2">
        <!-- Priority -->
        <div class="border border-gray-200 rounded p-1.5 bg-gray-50">
            <label for="id_priority" class="block text-xs font-medium text-gray-700 mb-0.5">
                Priority
            </label>
            <input type="number" 
                   name="priority" 
                   id="id_priority"
                   value="{{ promotion.priority|default:'100' }}"
                   min="0" 
                   max="999" 
                   step="1"
                   class="w-full px-1.5 py-0.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500">
        </div>

        <!-- Total Max Uses -->
        <div class="border border-gray-200 rounded p-1.5 bg-gray-50">
            <label class="flex items-center mb-0.5 cursor-pointer">
                <input type="checkbox" 
                       x-model="hasMaxUses" 
                       class="w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <span class="ml-1 text-xs font-medium text-gray-700">
                    Total
                </span>
            </label>
            
            <div x-show="hasMaxUses" x-transition>
                <input type="text" 
                       name="max_uses" 
                       id="id_max_uses" 
                       value="{% if promotion.max_uses %}{{ promotion.max_uses|floatformat:0|intcomma }}{% endif %}"
                       x-init="if ($el.value) $el.value = new Intl.NumberFormat('en-US').format($el.value.replace(/[^0-9]/g, ''))"
                       @input="let val = $event.target.value.replace(/[^0-9]/g, ''); if (val) $event.target.value = new Intl.NumberFormat('en-US').format(val);"
                       placeholder="1,000"
                       class="w-full px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-blue-500"
                       @focus="hasMaxUses = true">
            </div>
        </div>

        <!-- Per Customer Limit -->
        <div class="border border-gray-200 rounded p-1.5 bg-gray-50">
            <label class="flex items-center mb-0.5 cursor-pointer">
                <input type="checkbox" 
                       x-model="hasMaxPerCustomer" 
                       class="w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <span class="ml-1 text-xs font-medium text-gray-700">
                    Per User
                </span>
            </label>
            
            <div x-show="hasMaxPerCustomer" x-transition>
                <input type="number" 
                       name="max_uses_per_customer" 
                       id="id_max_uses_per_customer" 
                       value="{{ promotion.max_uses_per_customer|default:'' }}"
                       min="1"
                       placeholder="3"
                       class="w-full px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-blue-500"
                       @focus="hasMaxPerCustomer = true">
            </div>
        </div>

        <!-- Per Day Limit -->
        <div class="border border-gray-200 rounded p-1.5 bg-gray-50">
            <label class="flex items-center mb-0.5 cursor-pointer">
                <input type="checkbox" 
                       x-model="hasMaxPerDay" 
                       class="w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <span class="ml-1 text-xs font-medium text-gray-700">
                    Per Day
                </span>
            </label>
            
            <div x-show="hasMaxPerDay" x-transition>
                <input type="text" 
                       name="max_uses_per_day" 
                       id="id_max_uses_per_day" 
                       value="{% if promotion.max_uses_per_day %}{{ promotion.max_uses_per_day|floatformat:0|intcomma }}{% endif %}"
                       x-init="if ($el.value) $el.value = new Intl.NumberFormat('en-US').format($el.value.replace(/[^0-9]/g, ''))"
                       @input="let val = $event.target.value.replace(/[^0-9]/g, ''); if (val) $event.target.value = new Intl.NumberFormat('en-US').format(val);"
                       placeholder="100"
                       class="w-full px-1.5 py-0.5 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-blue-500"
                       @focus="hasMaxPerDay = true">
            </div>
        </div>
    </div>
</div>
