<!-- Brand Form - Compact (Match Products) -->
<form 
    hx-post="{% if brand %}{% url 'brand:edit' brand.pk %}{% else %}{% url 'brand:create' %}{% endif %}"
    x-data="{ loading: false }"
    @submit="loading = true"
    class="space-y-3">
    {% csrf_token %}
    
    <!-- Error Messages -->
    <div id="form-errors" class="hidden">
        <div class="bg-red-50 border border-red-200 text-red-800 px-3 py-2 rounded-lg text-xs">
            <i class="fas fa-exclamation-circle mr-1"></i>
            <span id="error-message"></span>
        </div>
    </div>
    
    <!-- Company Selection (only for create) -->
    {% if not brand %}
    <div>
        <label for="company_id" class="block text-xs font-medium text-gray-700 mb-1">
            Company <span class="text-red-500">*</span>
        </label>
        <select 
            name="company_id" 
            id="company_id"
            required
            class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Select Company</option>
            {% for company in companies %}
            <option value="{{ company.id }}">{{ company.name }} ({{ company.code }})</option>
            {% endfor %}
        </select>
    </div>
    {% else %}
    <div class="bg-blue-50 border border-blue-200 px-3 py-2 rounded-lg text-xs text-blue-900">
        <strong>Company:</strong> {{ brand.company.name }} ({{ brand.company.code }})
    </div>
    {% endif %}

    <!-- Brand Details -->
    <div class="grid grid-cols-2 gap-3">
        <!-- Brand Code -->
        <div>
            <label for="code" class="block text-xs font-medium text-gray-700 mb-1">
                Brand Code <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="code" 
                id="code"
                value="{{ brand.code|default:'' }}"
                required
                maxlength="20"
                placeholder="e.g., YGY-001"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent {% if brand %}bg-gray-100 cursor-not-allowed{% endif %}"
                {% if brand %}readonly{% endif %}>
        </div>
        
        <!-- Brand Name -->
        <div>
            <label for="name" class="block text-xs font-medium text-gray-700 mb-1">
                Brand Name <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="name" 
                id="name"
                value="{{ brand.name|default:'' }}"
                required
                maxlength="200"
                placeholder="e.g., Ayam Geprek Express"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <!-- Phone -->
        <div>
            <label for="phone" class="block text-xs font-medium text-gray-700 mb-1">
                Phone
            </label>
            <input 
                type="text" 
                name="phone" 
                id="phone"
                value="{{ brand.phone|default:'' }}"
                maxlength="20"
                placeholder="e.g., 021-1234567"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <!-- Tax ID -->
        <div>
            <label for="tax_id" class="block text-xs font-medium text-gray-700 mb-1">
                Tax ID (NPWP)
            </label>
            <input 
                type="text" 
                name="tax_id" 
                id="tax_id"
                value="{{ brand.tax_id|default:'' }}"
                maxlength="50"
                placeholder="e.g., 01.234.567.8-901.000"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
    </div>
    
    <!-- Address (Full Width) -->
    <div>
        <label for="address" class="block text-xs font-medium text-gray-700 mb-1">
            Address
        </label>
        <textarea 
            name="address" 
            id="address"
            rows="2"
            placeholder="Brand headquarters address"
            class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none">{{ brand.address|default:'' }}</textarea>
    </div>
    
    <!-- Financial Configuration -->
    <div class="grid grid-cols-3 gap-3">
        <!-- Tax Rate -->
        <div>
            <label for="tax_rate" class="block text-xs font-medium text-gray-700 mb-1">
                Tax Rate (%)
            </label>
            <input 
                type="number" 
                name="tax_rate" 
                id="tax_rate"
                value="{{ brand.tax_rate|default:'11.00' }}"
                step="0.01"
                min="0"
                max="100"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <!-- Service Charge -->
        <div>
            <label for="service_charge" class="block text-xs font-medium text-gray-700 mb-1">
                Service Charge (%)
            </label>
            <input 
                type="number" 
                name="service_charge" 
                id="service_charge"
                value="{{ brand.service_charge|default:'5.00' }}"
                step="0.01"
                min="0"
                max="100"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <!-- Point Expiry Override -->
        <div>
            <label for="point_expiry_months_override" class="block text-xs font-medium text-gray-700 mb-1">
                Point Expiry (months)
            </label>
            <input 
                type="number" 
                name="point_expiry_months_override" 
                id="point_expiry_months_override"
                value="{{ brand.point_expiry_months_override|default:'' }}"
                min="0"
                placeholder="Default"
                class="w-full px-3 py-1.5 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
    </div>
    
    <!-- Status -->
    <div class="flex items-center">
        <input 
            type="checkbox" 
            name="is_active" 
            id="is_active"
            {% if not brand or brand.is_active %}checked{% endif %}
            class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
        <label for="is_active" class="ml-2 text-xs text-gray-700">
            Active brand (visible in system)
        </label>
    </div>
    
    <!-- Form Actions -->
    <div class="flex justify-end gap-2 pt-2 border-t border-gray-200">
        <button 
            type="button"
            @click="showModal = false"
            class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
            Cancel
        </button>
        <button 
            type="submit"
            :disabled="loading"
            class="px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
            <span x-show="!loading" class="flex items-center">
                <i class="fas fa-save mr-1"></i>
                {% if brand %}Update{% else %}Create{% endif %}
            </span>
            <span x-show="loading" class="flex items-center">
                <i class="fas fa-circle-notch fa-spin mr-1"></i>
                Saving...
            </span>
        </button>
    </div>
</form>

<script>
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.target.id === 'modal-content') {
            try {
                const response = JSON.parse(evt.detail.xhr.response);
                if (response.success) {
                    window.location.href = response.redirect;
                } else {
                    document.getElementById('form-errors').classList.remove('hidden');
                    document.getElementById('error-message').textContent = response.message;
                }
            } catch (e) {}
        }
    });
</script>
