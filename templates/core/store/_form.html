<!-- Store Form - Ultra Compact -->
<form 
    hx-post="{% if store %}{% url 'store:edit' store.pk %}{% else %}{% url 'store:create' %}{% endif %}"
    x-data="{ loading: false }"
    @submit="loading = true"
    class="space-y-3">
    {% csrf_token %}
    
    <!-- Error Messages -->
    <div id="form-errors" class="hidden">
        <div class="bg-red-50 border border-red-200 text-red-800 px-3 py-2 rounded-lg text-xs">
            <i class="fas fa-exclamation-circle mr-1"></i>
            <span id="error-message"></span>
        </div>
    </div>
    
    <!-- Brand Selection (only for create) -->
    {% if not store %}
    <div>
        <label for="brand_id" class="block text-xs font-medium text-gray-700 mb-1">
            Brand <span class="text-red-500">*</span>
        </label>
        <select 
            name="brand_id" 
            id="brand_id"
            required
            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Select Brand</option>
            {% for brand in brands %}
            <option value="{{ brand.id }}">{{ brand.name }} - {{ brand.company.name }}</option>
            {% endfor %}
        </select>
    </div>
    {% else %}
    <div class="bg-blue-50 border border-blue-200 px-3 py-2 rounded-lg">
        <div class="text-xs text-blue-800">
            <i class="fas fa-info-circle mr-1"></i>
            <strong>Brand:</strong> {{ store.brand.name }} / {{ store.brand.company.name }}
        </div>
    </div>
    {% endif %}
    
    <!-- Two Column Layout -->
    <div class="grid grid-cols-2 gap-3">
        <!-- Store Code -->
        <div>
            <label for="store_code" class="block text-xs font-medium text-gray-700 mb-1">
                Store Code <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="store_code" 
                id="store_code"
                value="{{ store.store_code|default:'' }}"
                required
                maxlength="20"
                placeholder="e.g., YGY-001-BSD"
                class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                {% if store %}readonly{% endif %}>
        </div>
        
        <!-- Store Name -->
        <div>
            <label for="store_name" class="block text-xs font-medium text-gray-700 mb-1">
                Store Name <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="store_name" 
                id="store_name"
                value="{{ store.store_name|default:'' }}"
                required
                maxlength="200"
                placeholder="e.g., Cabang BSD"
                class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
    </div>
    
    <!-- Address -->
    <div>
        <label for="address" class="block text-xs font-medium text-gray-700 mb-1">
            Address <span class="text-red-500">*</span>
        </label>
        <textarea 
            name="address" 
            id="address"
            rows="2"
            required
            placeholder="Full store address"
            class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">{{ store.address|default:'' }}</textarea>
    </div>
    
    <div class="grid grid-cols-2 gap-3">
        <!-- Phone -->
        <div>
            <label for="phone" class="block text-xs font-medium text-gray-700 mb-1">
                Phone <span class="text-red-500">*</span>
            </label>
            <input 
                type="text" 
                name="phone" 
                id="phone"
                value="{{ store.phone|default:'' }}"
                required
                maxlength="20"
                placeholder="e.g., 021-1234567"
                class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        
        <!-- Timezone -->
        <div>
            <label for="timezone" class="block text-xs font-medium text-gray-700 mb-1">
                Timezone
            </label>
            <select 
                name="timezone" 
                id="timezone"
                class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="Asia/Jakarta" {% if not store or store.timezone == 'Asia/Jakarta' %}selected{% endif %}>Asia/Jakarta (WIB)</option>
                <option value="Asia/Makassar" {% if store.timezone == 'Asia/Makassar' %}selected{% endif %}>Asia/Makassar (WITA)</option>
                <option value="Asia/Jayapura" {% if store.timezone == 'Asia/Jayapura' %}selected{% endif %}>Asia/Jayapura (WIT)</option>
            </select>
        </div>
    </div>
    
    <!-- GPS Location -->
    <div class="border-t pt-3">
        <h4 class="text-xs font-semibold text-gray-900 mb-2">
            <i class="fas fa-map-marked-alt mr-1"></i>GPS Location (Optional)
        </h4>
        
        <div class="grid grid-cols-2 gap-3">
            <!-- Latitude -->
            <div>
                <label for="latitude" class="block text-xs font-medium text-gray-700 mb-1">
                    Latitude
                </label>
                <input 
                    type="number" 
                    name="latitude" 
                    id="latitude"
                    value="{{ store.latitude|default:'' }}"
                    step="0.000001"
                    min="-90"
                    max="90"
                    placeholder="e.g., -6.302395"
                    class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <p class="mt-0.5 text-xs text-gray-500">-90 to 90</p>
            </div>
            
            <!-- Longitude -->
            <div>
                <label for="longitude" class="block text-xs font-medium text-gray-700 mb-1">
                    Longitude
                </label>
                <input 
                    type="number" 
                    name="longitude" 
                    id="longitude"
                    value="{{ store.longitude|default:'' }}"
                    step="0.000001"
                    min="-180"
                    max="180"
                    placeholder="e.g., 106.652259"
                    class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <p class="mt-0.5 text-xs text-gray-500">-180 to 180</p>
            </div>
        </div>
        
        <p class="mt-2 text-xs text-gray-500">
            <i class="fas fa-info-circle mr-1"></i>
            You can get GPS coordinates from Google Maps. Right-click on location â†’ Click coordinates to copy.
        </p>
    </div>
    
    <!-- Status -->
    <div class="flex items-center">
        <input 
            type="checkbox" 
            name="is_active" 
            id="is_active"
            {% if not store or store.is_active %}checked{% endif %}
            class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
        <label for="is_active" class="ml-2 text-xs font-medium text-gray-700">
            Active Store
        </label>
    </div>
    
    <!-- Form Actions -->
    <div class="flex justify-end gap-2 pt-3 border-t">
        <button 
            type="button"
            @click="showModal = false"
            class="px-4 py-1.5 bg-white text-gray-700 text-sm font-medium rounded-lg border border-gray-300 hover:bg-gray-50 transition">
            Cancel
        </button>
        <button 
            type="submit"
            :disabled="loading"
            class="px-4 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition disabled:opacity-50">
            <span x-show="!loading">
                <i class="fas fa-save mr-1"></i>
                {% if store %}Update{% else %}Create{% endif %}
            </span>
            <span x-show="loading">
                <i class="fas fa-spinner fa-spin mr-1"></i>
                Saving...
            </span>
        </button>
    </div>
</form>

<script>
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.target.id === 'modal-content') {
            try {
                const response = JSON.parse(evt.detail.xhr.response);
                if (response.success) {
                    window.location.href = response.redirect;
                } else {
                    document.getElementById('form-errors').classList.remove('hidden');
                    document.getElementById('error-message').textContent = response.message;
                }
            } catch (e) {}
        }
    });
</script>
